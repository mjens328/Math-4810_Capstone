<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>PCA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="PCA_files/libs/clipboard/clipboard.min.js"></script>
<script src="PCA_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="PCA_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="PCA_files/libs/quarto-html/popper.min.js"></script>
<script src="PCA_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="PCA_files/libs/quarto-html/anchor.min.js"></script>
<link href="PCA_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="PCA_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="PCA_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="PCA_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="PCA_files/libs/bootstrap/bootstrap-81267100e462c21b3d6c0d5bf76a3417.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><strong>PCA</strong></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="cd8898a8" class="cell" data-cache="true" title="Initial Imports" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.manifold <span class="im">import</span> TSNE</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> KMeans</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I will be using the Parcel Export Sheet 2 data for the time being as Joseph had stated that best case scenario this is the data used to predict with. While he had mentioned that some of the data is out of date, I wanted to see what insights could be pulled from this first, then work with the other datasets later on as we get a better understanding of the data.</p>
<div id="07bab25f" class="cell" data-cache="true" title="Read in Parcel Export Sheet 2" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>parcel_export <span class="op">=</span> pd.read_excel(<span class="st">"Parcel Export.xlsx"</span>, sheet_name<span class="op">=</span><span class="st">"Full Parcel Summary"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>parcel_export.head()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>parcel_export.shape <span class="co"># (53277, 53)</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>parcel_export.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.DataFrame'&gt;
RangeIndex: 53277 entries, 0 to 53276
Data columns (total 53 columns):
 #   Column                       Non-Null Count  Dtype  
---  ------                       --------------  -----  
 0   ParcelId                     53277 non-null  str    
 1   TaxYear                      53277 non-null  int64  
 2   Active                       53277 non-null  str    
 3   ImpOnly                      53277 non-null  int64  
 4   IsIncluded                   53277 non-null  bool   
 5   PropType                     53277 non-null  int64  
 6   PropTypeDescription          53277 non-null  str    
 7   Subdivision                  38318 non-null  str    
 8   Acreage                      53277 non-null  float64
 9   Jurisdiction                 53277 non-null  int64  
 10  RecordType                   53277 non-null  str    
 11  SpecificPropType             53277 non-null  int64  
 12  SpecificPropTypeDescription  53277 non-null  str    
 13  Lat                          51923 non-null  float64
 14  Lng                          51923 non-null  float64
 15  ReviewedDate                 52414 non-null  float64
 16  ReviewedBy                   52414 non-null  str    
 17  NbhdCode2                    53277 non-null  object 
 18  Area                         53277 non-null  str    
 19  ImpCode                      53277 non-null  int64  
 20  Res Imp Count                21893 non-null  float64
 21  TotGLA                       21893 non-null  float64
 22  Tot Bsmt                     21893 non-null  float64
 23  EffYearBuilt_Weighted        21893 non-null  float64
 24  Quality_Weighted             21893 non-null  float64
 25  MainImp.GroupCode            21893 non-null  str    
 26  Main_StyleDesc               21893 non-null  str    
 27  FullBaths_Total              21893 non-null  float64
 28  HalfBaths_Total              21893 non-null  float64
 29  BsmtFinishPct_Weighted       9663 non-null   float64
 30  Laundry_Count                21893 non-null  float64
 31  KitchenCount                 21893 non-null  float64
 32  CarportArea                  21893 non-null  float64
 33  CarportCapacity              21893 non-null  float64
 34  GarageArea                   21893 non-null  float64
 35  GarageCapacity               21893 non-null  float64
 36  Main_YearBuilt               21893 non-null  float64
 37  Count_DetGarage              10572 non-null  float64
 38  SqFt_DetGarage               2376 non-null   float64
 39  Count_ DetCarport            10572 non-null  float64
 40  SqFt_DetCarport              500 non-null    float64
 41  Count_Barn                   10572 non-null  float64
 42  Sqft_Barn                    162 non-null    float64
 43  Count_Guest_House            10572 non-null  float64
 44  SqFt_Guest_House             25 non-null     float64
 45  Count_Pools                  10572 non-null  float64
 46  SqFt_Pools                   84 non-null     float64
 47  Count_Recreational_Courts    10572 non-null  float64
 48  SqFt_Recreational_Courts     52 non-null     float64
 49  Count_Shed                   10572 non-null  float64
 50  SqFt_Shed                    3587 non-null   float64
 51  Count_Gazebo_Pavilion        10572 non-null  float64
 52  SqFt_Gazebo_Pavilion         110 non-null    float64
dtypes: bool(1), float64(35), int64(6), object(1), str(10)
memory usage: 25.4+ MB</code></pre>
</div>
</div>
<div id="e3e3f6f1" class="cell" data-cache="true" title="Non-numeric columns" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>non_numeric_cols <span class="op">=</span> parcel_export.select_dtypes(exclude<span class="op">=</span>[np.number]).columns.tolist()</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>parcel_export[non_numeric_cols].shape <span class="co"># (53277, 12)</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>parcel_export[non_numeric_cols].info()</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>parcel_export[non_numeric_cols].columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.DataFrame'&gt;
RangeIndex: 53277 entries, 0 to 53276
Data columns (total 12 columns):
 #   Column                       Non-Null Count  Dtype 
---  ------                       --------------  ----- 
 0   ParcelId                     53277 non-null  str   
 1   Active                       53277 non-null  str   
 2   IsIncluded                   53277 non-null  bool  
 3   PropTypeDescription          53277 non-null  str   
 4   Subdivision                  38318 non-null  str   
 5   RecordType                   53277 non-null  str   
 6   SpecificPropTypeDescription  53277 non-null  str   
 7   ReviewedBy                   52414 non-null  str   
 8   NbhdCode2                    53277 non-null  object
 9   Area                         53277 non-null  str   
 10  MainImp.GroupCode            21893 non-null  str   
 11  Main_StyleDesc               21893 non-null  str   
dtypes: bool(1), object(1), str(10)
memory usage: 8.7+ MB</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>Index(['ParcelId', 'Active', 'IsIncluded', 'PropTypeDescription',
       'Subdivision', 'RecordType', 'SpecificPropTypeDescription',
       'ReviewedBy', 'NbhdCode2', 'Area', 'MainImp.GroupCode',
       'Main_StyleDesc'],
      dtype='str')</code></pre>
</div>
</div>
<div id="e553bb7d" class="cell" data-cache="true" title="Numeric columns" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>numeric_parcel_cols <span class="op">=</span> parcel_export.select_dtypes(include<span class="op">=</span>[np.number]).columns.tolist() </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>parcel_export[numeric_parcel_cols].shape <span class="co"># (53277, 41)</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>parcel_export[numeric_parcel_cols].info() <span class="co"># Identifyed columns with a lot of missing values to drop</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>parcel_export[numeric_parcel_cols].columns <span class="co"># List of numeric columns for copy/paste</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.DataFrame'&gt;
RangeIndex: 53277 entries, 0 to 53276
Data columns (total 41 columns):
 #   Column                     Non-Null Count  Dtype  
---  ------                     --------------  -----  
 0   TaxYear                    53277 non-null  int64  
 1   ImpOnly                    53277 non-null  int64  
 2   PropType                   53277 non-null  int64  
 3   Acreage                    53277 non-null  float64
 4   Jurisdiction               53277 non-null  int64  
 5   SpecificPropType           53277 non-null  int64  
 6   Lat                        51923 non-null  float64
 7   Lng                        51923 non-null  float64
 8   ReviewedDate               52414 non-null  float64
 9   ImpCode                    53277 non-null  int64  
 10  Res Imp Count              21893 non-null  float64
 11  TotGLA                     21893 non-null  float64
 12  Tot Bsmt                   21893 non-null  float64
 13  EffYearBuilt_Weighted      21893 non-null  float64
 14  Quality_Weighted           21893 non-null  float64
 15  FullBaths_Total            21893 non-null  float64
 16  HalfBaths_Total            21893 non-null  float64
 17  BsmtFinishPct_Weighted     9663 non-null   float64
 18  Laundry_Count              21893 non-null  float64
 19  KitchenCount               21893 non-null  float64
 20  CarportArea                21893 non-null  float64
 21  CarportCapacity            21893 non-null  float64
 22  GarageArea                 21893 non-null  float64
 23  GarageCapacity             21893 non-null  float64
 24  Main_YearBuilt             21893 non-null  float64
 25  Count_DetGarage            10572 non-null  float64
 26  SqFt_DetGarage             2376 non-null   float64
 27  Count_ DetCarport          10572 non-null  float64
 28  SqFt_DetCarport            500 non-null    float64
 29  Count_Barn                 10572 non-null  float64
 30  Sqft_Barn                  162 non-null    float64
 31  Count_Guest_House          10572 non-null  float64
 32  SqFt_Guest_House           25 non-null     float64
 33  Count_Pools                10572 non-null  float64
 34  SqFt_Pools                 84 non-null     float64
 35  Count_Recreational_Courts  10572 non-null  float64
 36  SqFt_Recreational_Courts   52 non-null     float64
 37  Count_Shed                 10572 non-null  float64
 38  SqFt_Shed                  3587 non-null   float64
 39  Count_Gazebo_Pavilion      10572 non-null  float64
 40  SqFt_Gazebo_Pavilion       110 non-null    float64
dtypes: float64(35), int64(6)
memory usage: 16.7 MB</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>Index(['TaxYear', 'ImpOnly', 'PropType ', 'Acreage', 'Jurisdiction',
       'SpecificPropType', 'Lat', 'Lng', 'ReviewedDate', 'ImpCode',
       'Res Imp Count', 'TotGLA', 'Tot Bsmt', 'EffYearBuilt_Weighted',
       'Quality_Weighted', 'FullBaths_Total', 'HalfBaths_Total',
       'BsmtFinishPct_Weighted', 'Laundry_Count', 'KitchenCount',
       'CarportArea', 'CarportCapacity', 'GarageArea', 'GarageCapacity',
       'Main_YearBuilt', 'Count_DetGarage', 'SqFt_DetGarage',
       'Count_ DetCarport', 'SqFt_DetCarport', 'Count_Barn', 'Sqft_Barn',
       'Count_Guest_House', 'SqFt_Guest_House', 'Count_Pools', 'SqFt_Pools',
       'Count_Recreational_Courts', 'SqFt_Recreational_Courts', 'Count_Shed',
       'SqFt_Shed', 'Count_Gazebo_Pavilion', 'SqFt_Gazebo_Pavilion'],
      dtype='str')</code></pre>
</div>
</div>
<div id="2bbd20d2" class="cell" data-cache="true" title="Filter Parcel Export for PCA (only numeric columns)" data-execution_count="5">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>numeric_parcel_data <span class="op">=</span> parcel_export[numeric_parcel_cols].drop(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    columns <span class="op">=</span> [<span class="st">'BsmtFinishPct_Weighted'</span>,<span class="st">'Count_DetGarage'</span>, <span class="st">'SqFt_DetGarage'</span>, <span class="st">'Count_ DetCarport'</span>, </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">'SqFt_DetCarport'</span>, <span class="st">'Count_Barn'</span>, <span class="st">'Sqft_Barn'</span>, <span class="st">'Count_Guest_House'</span>, <span class="st">'SqFt_Guest_House'</span>, </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Count_Pools'</span>, <span class="st">'SqFt_Pools'</span>, <span class="st">'Count_Recreational_Courts'</span>, <span class="st">'SqFt_Recreational_Courts'</span>, </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Count_Shed'</span>, <span class="st">'SqFt_Shed'</span>, <span class="st">'Count_Gazebo_Pavilion'</span>, <span class="st">'SqFt_Gazebo_Pavilion'</span>])</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>numeric_parcel_data.shape <span class="co"># (53277, 24)</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>numeric_parcel_data.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.DataFrame'&gt;
RangeIndex: 53277 entries, 0 to 53276
Data columns (total 24 columns):
 #   Column                 Non-Null Count  Dtype  
---  ------                 --------------  -----  
 0   TaxYear                53277 non-null  int64  
 1   ImpOnly                53277 non-null  int64  
 2   PropType               53277 non-null  int64  
 3   Acreage                53277 non-null  float64
 4   Jurisdiction           53277 non-null  int64  
 5   SpecificPropType       53277 non-null  int64  
 6   Lat                    51923 non-null  float64
 7   Lng                    51923 non-null  float64
 8   ReviewedDate           52414 non-null  float64
 9   ImpCode                53277 non-null  int64  
 10  Res Imp Count          21893 non-null  float64
 11  TotGLA                 21893 non-null  float64
 12  Tot Bsmt               21893 non-null  float64
 13  EffYearBuilt_Weighted  21893 non-null  float64
 14  Quality_Weighted       21893 non-null  float64
 15  FullBaths_Total        21893 non-null  float64
 16  HalfBaths_Total        21893 non-null  float64
 17  Laundry_Count          21893 non-null  float64
 18  KitchenCount           21893 non-null  float64
 19  CarportArea            21893 non-null  float64
 20  CarportCapacity        21893 non-null  float64
 21  GarageArea             21893 non-null  float64
 22  GarageCapacity         21893 non-null  float64
 23  Main_YearBuilt         21893 non-null  float64
dtypes: float64(18), int64(6)
memory usage: 9.8 MB</code></pre>
</div>
</div>
<div id="a63ff77c" class="cell" data-cache="true" title="Drop rows with missing values" data-execution_count="6">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>numeric_parcel_data1 <span class="op">=</span> numeric_parcel_data.dropna()</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>numeric_parcel_data1.shape <span class="co"># (21440, 24)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>(21440, 24)</code></pre>
</div>
</div>
<div id="09c4e382" class="cell" data-cache="true" title="Scaling the data for PCA" data-execution_count="7">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>X_scaled <span class="op">=</span> scaler.fit_transform(numeric_parcel_data1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="99821aa2" class="cell" data-cache="true" title="PCA and Scree Plot" data-execution_count="8">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>pca_full <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="va">None</span>) <span class="co"># n_components=None keeps all features as components</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>pca_full.fit(X_scaled)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>PCA()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;PCA<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.decomposition.PCA.html">?<span>Documentation for PCA</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>PCA()</pre></div> </div></div></div></div>
</div>
</div>
<div id="800d7a6a" class="cell" data-cache="true" title="Scree Plot to optimize number of components" data-execution_count="9">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>plt.plot(<span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(pca_full.explained_variance_ratio_) <span class="op">+</span> <span class="dv">1</span>), </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>         pca_full.explained_variance_ratio_.cumsum(), </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>         marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Scree Plot (Cumulative Variance)'</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Number of Components'</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Cumulative Explained Variance'</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="PCA_files/figure-html/cell-10-output-1.png" width="668" height="523" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="490b7e9d" class="cell" data-cache="true" title="PCA with 10 components" data-execution_count="10">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>principal_components <span class="op">=</span> pca.fit_transform(X_scaled)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>pca_df <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>principal_components, columns<span class="op">=</span>[</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'PC1'</span>, <span class="st">'PC2'</span>, <span class="st">'PC3'</span>, <span class="st">'PC4'</span>, <span class="st">'PC5'</span>, <span class="st">'PC6'</span>, <span class="st">'PC7'</span>, <span class="st">'PC8'</span>, <span class="st">'PC9'</span>, <span class="st">'PC10'</span>])</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>pca.explained_variance_ratio_.<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>0.8087081867674848</code></pre>
</div>
</div>
<div id="ab9f8896" class="cell" data-cache="true" title="TNSE on PCA components" data-execution_count="11">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>tsne <span class="op">=</span> TSNE(n_components<span class="op">=</span><span class="dv">2</span>, random_state<span class="op">=</span><span class="dv">42</span>, n_iter<span class="op">=</span><span class="dv">5000</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>tsne_results <span class="op">=</span> tsne.fit_transform(pca_df)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">6</span>))</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>plt.scatter(tsne_results[:,<span class="dv">0</span>], tsne_results[:,<span class="dv">1</span>], alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'T-SNE Visualization of Clusters'</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'t-SNE Dimension 1'</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'t-SNE Dimension 2'</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="PCA_files/figure-html/cell-12-output-1.png" width="680" height="523" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="e35d1693" class="cell" data-cache="true" title="Optimize K for K-Means using Elbow Method" data-execution_count="12">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>wcss <span class="op">=</span> []</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">11</span>): </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span>i, init<span class="op">=</span><span class="st">'k-means++'</span>, random_state<span class="op">=</span><span class="dv">42</span>, n_init<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    kmeans.fit(pca_df)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    wcss.append(kmeans.inertia_)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>plt.plot(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">11</span>), wcss, marker<span class="op">=</span><span class="st">'o'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Elbow Method for Optimal K'</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Number of Clusters (K)'</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'WCSS'</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>plt.xticks(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">11</span>))</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="PCA_files/figure-html/cell-13-output-1.png" width="842" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="04fd5692" class="cell" data-cache="true" title="K-Means Clustering and Visualization for K=2 to K=5" data-execution_count="13">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>,<span class="dv">6</span>):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span>i, random_state<span class="op">=</span><span class="dv">42</span>, n_init<span class="op">=</span><span class="dv">10</span>) </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    cluster_labels <span class="op">=</span> kmeans.fit_predict(pca_df)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    tsne_df <span class="op">=</span> pd.DataFrame(tsne_results, columns<span class="op">=</span>[<span class="st">'tSNE Dim 1'</span>, <span class="st">'tSNE Dim 2'</span>])</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    tsne_df[<span class="st">'Cluster'</span>] <span class="op">=</span> cluster_labels</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    sns.scatterplot(</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>tsne_df, </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span><span class="st">'tSNE Dim 1'</span>, </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span><span class="st">'tSNE Dim 2'</span>, </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>        hue<span class="op">=</span><span class="st">'Cluster'</span>, </span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>        palette<span class="op">=</span>sns.color_palette(<span class="st">'Accent'</span>, n_colors<span class="op">=</span><span class="dv">6</span>), </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>        legend<span class="op">=</span><span class="st">'full'</span>,</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'T-SNE Visualization Colored by K-Means Clusters'</span>)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'t-SNE Dimension 1'</span>)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'t-SNE Dimension 2'</span>)</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/2s/bxjklpkx53v39lgfmtz7pr380000gn/T/ipykernel_92412/2919497112.py:9: UserWarning:

The palette list has more values (6) than needed (2), which may not be intended.
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="PCA_files/figure-html/cell-14-output-2.png" width="828" height="671" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/2s/bxjklpkx53v39lgfmtz7pr380000gn/T/ipykernel_92412/2919497112.py:9: UserWarning:

The palette list has more values (6) than needed (3), which may not be intended.
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="PCA_files/figure-html/cell-14-output-4.png" width="828" height="671" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/2s/bxjklpkx53v39lgfmtz7pr380000gn/T/ipykernel_92412/2919497112.py:9: UserWarning:

The palette list has more values (6) than needed (4), which may not be intended.
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="PCA_files/figure-html/cell-14-output-6.png" width="828" height="671" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/2s/bxjklpkx53v39lgfmtz7pr380000gn/T/ipykernel_92412/2919497112.py:9: UserWarning:

The palette list has more values (6) than needed (5), which may not be intended.
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="PCA_files/figure-html/cell-14-output-8.png" width="828" height="671" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="1594d355" class="cell" data-cache="true" title="Relate back to original features for K=2 to K=5" data-execution_count="14">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span> (<span class="dv">2</span>,<span class="dv">6</span>):</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span>i, random_state<span class="op">=</span><span class="dv">42</span>, n_init<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    cluster_labels <span class="op">=</span> kmeans.fit_predict(pca_df)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    numeric_parcel_data1[<span class="st">'Cluster'</span>] <span class="op">=</span> cluster_labels</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Distribution across Clusters</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    cluster_counts <span class="op">=</span> numeric_parcel_data1[<span class="st">'Cluster'</span>].value_counts()</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Cluster Counts:"</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(cluster_counts)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate and compare the mean of all features for each cluster</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    cluster_profiles <span class="op">=</span> numeric_parcel_data1.groupby(<span class="st">'Cluster'</span>).mean().T</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(cluster_profiles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cluster Counts:
Cluster
1    12090
0     9350
Name: count, dtype: int64
Cluster                           0             1
TaxYear                 2026.000000   2026.000000
ImpOnly                    0.000000      0.000000
PropType                 139.173369    115.786766
Acreage                    5.491456      1.643804
Jurisdiction              11.000000     11.000000
SpecificPropType         173.048449    139.421836
Lat                       37.674987     37.242477
Lng                     -112.942253   -111.676402
ReviewedDate           45332.596809  45453.469334
ImpCode                    2.088984      2.142101
Res Imp Count              1.021604      1.024235
TotGLA                  1422.513583   2052.757816
Tot Bsmt                 432.056578    801.852440
EffYearBuilt_Weighted   2004.268447   2016.372602
Quality_Weighted           2.929361      3.564393
FullBaths_Total            1.899251      2.530108
HalfBaths_Total            0.183209      0.452688
Laundry_Count              1.038610      1.069892
KitchenCount               1.067594      1.081307
CarportArea               71.812620      3.040778
CarportCapacity            0.065882      0.000579
GarageArea               138.571872    642.428867
GarageCapacity             0.544278      2.402564
Main_YearBuilt          1980.538930   2011.455997
Cluster Counts:
Cluster
1    12471
0     8810
2      159
Name: count, dtype: int64
Cluster                           0             1             2
TaxYear                 2026.000000   2026.000000   2026.000000
ImpOnly                    0.000000      0.000000      0.000000
PropType                 140.776277    115.529949    126.540881
Acreage                    5.704587      1.660152      1.619667
Jurisdiction              11.000000     11.000000     11.000000
SpecificPropType         175.331782    139.318258    135.232704
Lat                       37.715748     37.707236      0.000000
Lng                     -113.063065   -113.069695      0.000000
ReviewedDate           45332.920086  45443.991156  45768.457547
ImpCode                    2.091260      2.106728      4.610063
Res Imp Count              1.022247      1.023895      1.006289
TotGLA                  1418.341998   2032.521289   1730.679245
Tot Bsmt                 430.684563    794.279208    215.962264
EffYearBuilt_Weighted   2003.857463   2016.087545   2020.394400
Quality_Weighted           2.920490      3.546609      3.293984
FullBaths_Total            1.882293      2.520648      2.069182
HalfBaths_Total            0.180704      0.439740      0.691824
Laundry_Count              1.040522      1.067356      1.056604
KitchenCount               1.071169      1.079144      1.006289
CarportArea               76.114642      2.864486     12.062893
CarportCapacity            0.069694      0.000401      0.025157
GarageArea               122.329625    634.042258    488.974843
GarageCapacity             0.479909      2.376473      1.704403
Main_YearBuilt          1979.328263   2010.900489   2017.106918
Cluster Counts:
Cluster
0    8542
1    7275
2    5464
3     159
Name: count, dtype: int64
Cluster                           0             1             2             3
TaxYear                 2026.000000   2026.000000   2026.000000   2026.000000
ImpOnly                    0.000000      0.000000      0.000000      0.000000
PropType                 129.697144    114.034914    136.079063    126.540881
Acreage                    1.448194      2.451014      7.459657      1.619667
Jurisdiction              11.000000     11.000000     11.000000     11.000000
SpecificPropType         138.116834    152.040962    182.324122    135.232704
Lat                       37.711070     37.705486     37.717295      0.000000
Lng                     -113.073899   -113.068290   -113.054302      0.000000
ReviewedDate           45396.671608  45452.882251  45327.041072  45768.457547
ImpCode                    3.323226      1.054708      1.580710      4.610063
Res Imp Count              1.005853      1.042337      1.024890      1.006289
TotGLA                  1537.909974   2342.940619   1402.168009   1730.679245
Tot Bsmt                 127.764107   1279.565911    603.877013    215.962264
EffYearBuilt_Weighted   2015.298643   2014.525854   1999.680717   2020.394400
Quality_Weighted           3.178683      3.686868      2.925514      3.293984
FullBaths_Total            1.966050      2.881100      1.878477      2.069182
HalfBaths_Total            0.360220      0.428729      0.161054      0.691824
Laundry_Count              1.013697      1.121375      1.036054      1.056604
KitchenCount               1.001990      1.146942      1.096633      1.006289
CarportArea                1.292086      4.522887    121.221083     12.062893
CarportCapacity            0.000937      0.000687      0.110908      0.025157
GarageArea               327.722430    772.808935    103.088397    488.974843
GarageCapacity             1.275697      2.852784      0.405198      1.704403
Main_YearBuilt          2009.299461   2007.759313   1966.679539   2017.106918
Cluster Counts:
Cluster
0    10081
2     7620
4     3166
1      414
3      159
Name: count, dtype: int64
Cluster                           0             1             2             3  \
TaxYear                 2026.000000   2026.000000   2026.000000   2026.000000   
ImpOnly                    0.000000      0.000000      0.000000      0.000000   
PropType                 112.817379    183.089372    129.653412    126.540881   
Acreage                    1.599790     16.101932      6.053420      1.619667   
Jurisdiction              11.000000     11.000000     11.000000     11.000000   
SpecificPropType         140.135205    211.891304    180.012336    135.232704   
Lat                       37.708453     37.713854     37.717338      0.000000   
Lng                     -113.068637   -113.104708   -113.060283      0.000000   
ReviewedDate           45440.722485  45421.264694  45327.158306  45768.457547   
ImpCode                    1.078068      1.282609      1.712598      4.610063   
Res Imp Count              1.002083      1.987923      1.007612      1.006289   
TotGLA                  2040.790497   4352.565217   1395.974147   1730.679245   
Tot Bsmt                 967.139966    772.268116    454.357480    215.962264   
EffYearBuilt_Weighted   2014.965947   2009.181785   2002.791867   2020.394400   
Quality_Weighted           3.583381      3.119251      2.902244      3.293984   
FullBaths_Total            2.532685      5.543478      1.852362      2.069182   
HalfBaths_Total            0.314651      0.644928      0.133465      0.691824   
Laundry_Count              1.020236      2.997585      1.017323      1.056604   
KitchenCount               1.037496      3.084541      1.053281      1.006289   
CarportArea                2.829680     60.019324     85.060892     12.062893   
CarportCapacity            0.000397      0.014493      0.078871      0.025157   
GarageArea               695.763714    413.311594    115.618241    488.974843   
GarageCapacity             2.579903      1.388889      0.458136      1.704403   
Main_YearBuilt          2008.641107   1995.287440   1976.467979   2017.106918   

Cluster                           4  
TaxYear                 2026.000000  
ImpOnly                    0.000000  
PropType                 151.592862  
Acreage                    0.644481  
Jurisdiction              11.000000  
SpecificPropType         129.498105  
Lat                       37.701868  
Lng                     -113.072688  
ReviewedDate           45429.490340  
ImpCode                    6.395452  
Res Imp Count              1.001895  
TotGLA                  1525.796589  
Tot Bsmt                  53.103601  
EffYearBuilt_Weighted   2018.529700  
Quality_Weighted           3.293983  
FullBaths_Total            1.919141  
HalfBaths_Total            0.827543  
Laundry_Count              1.010739  
KitchenCount               0.989577  
CarportArea                1.501895  
CarportCapacity            0.002527  
GarageArea               290.192356  
GarageCapacity             1.197410  
Main_YearBuilt          2015.153506  </code></pre>
</div>
</div>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>